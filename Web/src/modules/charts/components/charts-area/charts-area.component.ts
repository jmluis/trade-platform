import {
    AfterViewInit,
    ChangeDetectionStrategy,
    Component,
    ElementRef,
    Input,
    OnInit,
    ViewChild,
} from '@angular/core';
import { Stock } from '@modules/dashboard/models';
import { Chart } from 'chart.js';
import { Observable } from 'rxjs';

@Component({
    selector: 'sb-charts-area',
    changeDetection: ChangeDetectionStrategy.OnPush,
    templateUrl: './charts-area.component.html',
    styleUrls: ['charts-area.component.scss'],
})
export class ChartsAreaComponent implements OnInit, AfterViewInit {
    @Input() stock!: Observable<Stock>;
    private _stock!: Stock;

    @ViewChild('myAreaChart') myAreaChart!: ElementRef<HTMLCanvasElement>;
    chart!: Chart;

    constructor() {}
    ngOnInit() {
        this.stock.subscribe(stock => {
            this._stock = stock;
        });
    }

    ngAfterViewInit() {
        this.chart = new Chart(this.myAreaChart.nativeElement, {
            type: 'line',
            data: {
                labels: [
                    '04-11',
                    '04-12',
                    '04-13',
                    '04-16',
                    '04-17',
                    '04-18',
                    '04-19',
                    '04-20',
                    '04-23',
                    '04-24',
                    '04-25',
                    '04-26',
                    '04-27',
                    '04-30',
                    '05-01',
                    '05-02',
                    '05-03',
                    '05-04',
                    '05-07',
                    '05-08',
                    '05-09',
                    '05-10',
                    '05-11',
                    '05-14',
                    '05-15',
                    '05-16',
                    '05-17',
                    '05-18',
                    '05-21',
                    '05-22',
                    '05-23',
                    '05-24',
                    '05-25',
                    '05-29',
                    '05-30',
                    '05-31',
                    '06-01',
                    '06-04',
                    '06-05',
                    '06-06',
                    '06-07',
                    '06-08',
                    '06-11',
                    '06-12',
                    '06-13',
                    '06-14',
                    '06-15',
                    '06-18',
                    '06-19',
                    '06-20',
                    '06-21',
                    '06-22',
                    '06-25',
                    '06-26',
                    '06-27',
                    '06-28',
                    '06-29',
                    '07-02',
                    '07-03',
                    '07-05',
                    '07-06',
                    '07-09',
                    '07-10',
                    '07-11',
                    '07-12',
                    '07-13',
                    '07-16',
                    '07-17',
                    '07-18',
                    '07-19',
                    '07-20',
                    '07-23',
                    '07-24',
                    '07-25',
                    '07-26',
                    '07-27',
                    '07-30',
                    '07-31',
                ],
                datasets: [
                    {
                        label: 'Sessions',
                        lineTension: 0.3,
                        backgroundColor: 'rgba(192,192,192,0)',
                        borderColor: 'rgba(255,0,0,0.7)',

                        data: [
                            73.942856,
                            74.21714,
                            74.431427,
                            74.874283,
                            76.615715,
                            78.497147,
                            79.714287,
                            79.757141,
                            80.785713,
                            81.807144,
                            80.827141,
                            80.128571,
                            80.511429,
                            80.545715,
                            79.637146,
                            79.167145,
                            79.382858,
                            78.980003,
                            76.778572,
                            77.760002,
                            76.972855,
                            78.114288,
                            77.118568,
                            75.701431,
                            76.888573,
                            79.074287,
                            79.271431,
                            77.821426,
                            76.141426,
                            76.112854,
                            74.735718,
                            75.625717,
                            74.80143,
                            73.877144,
                            75.582855,
                            74.774284,
                            75.85714,
                            75.845711,
                            76.112854,
                            75.870003,
                            75.480003,
                            76.492859,
                            76.358574,
                            76.777145,
                            75.541428,
                            75.385712,
                            75.128571,
                            76.03714,
                            75.69857,
                            75.989998,
                            76.917145,
                            77.35714,
                            78.074287,
                            77.145714,
                            76.902855,
                            77.03286,
                            76.822861,
                            77.482857,
                            77.341431,
                            77.115715,
                            75.431427,
                            75.027145,
                            74.662857,
                            75.811432,
                            74.14286,
                            74.557144,
                            74.324287,
                            74.007141,
                            74.285713,
                            75.048569,
                            75.472855,
                            75.580002,
                            81.172859,
                            80.647141,
                            81.828575,
                            79.03714,
                            75.69857,
                            75.989998,
                        ],
                    },
                ],
            },
            options: {
                scales: {
                    xAxes: [
                        {
                            time: {
                                unit: 'week',
                            },
                            gridLines: {
                                display: false,
                            },
                            ticks: {
                                maxTicksLimit: 7,
                            },
                        },
                    ],
                    yAxes: [
                        {
                            ticks: {
                                min: 66,
                                max: 86,
                                maxTicksLimit: 6,
                            },
                        },
                    ],
                },
                legend: {
                    display: false,
                },
            },
        });
    }
}
